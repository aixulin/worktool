<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本比较工具 - 行内差异显示</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .text-area-container {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .line-count {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .text-area-wrapper {
            position: relative;
            flex: 1;
            display: flex;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            min-height: 300px;
        }
        
        .line-numbers {
            width: 50px;
            background-color: #f5f5f5;
            padding: 15px 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: #7f8c8d;
            text-align: right;
            overflow-y: hidden;
            user-select: none;
            border-right: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .text-input-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        textarea {
            flex: 1;
            padding: 15px;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            line-height: 1.5;
            outline: none;
            overflow-y: auto;
            min-height: 100%;
            background: transparent;
            color: #333;
            caret-color: #333;
            position: relative;
            z-index: 2;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .highlight-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-y: hidden;
            background-color: white;
            z-index: 1;
            pointer-events: none;
            color: transparent;
        }
        
        .line {
            padding: 0;
            margin: 0;
            min-height: 21px;
        }
        
        .different {
            background-color: #ffebee;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #e74c3c;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .btn-compare {
            background: #9b59b6;
            color: white;
        }
        
        .btn-compare:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            padding: 10px;
            background: #ffeaea;
            border-radius: 6px;
            display: none;
        }
        
        .success-message {
            color: #27ae60;
            margin-top: 10px;
            padding: 10px;
            background: #eaffea;
            border-radius: 6px;
            display: none;
        }
        
        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        @media (max-width: 768px) {
            .input-section {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
        
        .toggle-container {
            display: none;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .toggle-label {
            font-size: 0.9rem;
            color: white;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #3498db;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>文本比较工具</h1>
        </header>
        
        <div class="app-container">
            <div class="input-section">
                <div class="text-area-container">
                    <h2 class="section-title">
                        原始文本
                        <span class="line-count" id="lineCount1">行数: 0</span>
                    </h2>
                    <div class="text-area-wrapper" id="wrapper1">
                        <div class="line-numbers" id="lineNumbers1"></div>
                        <div class="text-input-container">
                            <textarea id="text1" placeholder="请输入或粘贴原始文本...">Hello, this is the original text.
This is the second line.
This line will be modified.
This line will be removed.
Another line of text.
Final line of the original text.</textarea>
                            <div class="highlight-overlay" id="highlight1"></div>
                        </div>
                    </div>
                </div>
                
                <div class="text-area-container">
                    <h2 class="section-title">
                        比较文本
                        <span class="line-count" id="lineCount2">行数: 0</span>
                    </h2>
                    <div class="text-area-wrapper" id="wrapper2">
                        <div class="line-numbers" id="lineNumbers2"></div>
                        <div class="text-input-container">
                            <textarea id="text2" placeholder="请输入或粘贴比较文本...">Hello, this is the modified text.
This is the second line.
This line has been changed.
This is a new line added.
Another line of text.
Final line of the modified text.
One more new line.</textarea>
                            <div class="highlight-overlay" id="highlight2"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="toggle-container">
                <span class="toggle-label">实时比较:</span>
                <label class="switch">
                    <input type="checkbox" id="realtimeToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="button-group">
                <button class="btn-compare" id="compareBtn">比较文本</button>
                <button class="btn-success" id="exampleBtn">加载示例</button>
                <button class="btn-secondary" id="clearBtn">清空文本</button>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
        </div>
        
        <footer>
            <p>微信搜索【职场高效工具箱】解锁更多高效办公工具</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const text1 = document.getElementById('text1');
            const text2 = document.getElementById('text2');
            const compareBtn = document.getElementById('compareBtn');
            const exampleBtn = document.getElementById('exampleBtn');
            const clearBtn = document.getElementById('clearBtn');
            const lineNumbers1 = document.getElementById('lineNumbers1');
            const lineNumbers2 = document.getElementById('lineNumbers2');
            const lineCount1 = document.getElementById('lineCount1');
            const lineCount2 = document.getElementById('lineCount2');
            const highlight1 = document.getElementById('highlight1');
            const highlight2 = document.getElementById('highlight2');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const realtimeToggle = document.getElementById('realtimeToggle');
            
            // 示例数据
            const exampleData = {
                text1: `Hello, this is the original text.
This is the second line.
This line will be modified.
This line will be removed.
Another line of text.
Final line of the original text.`,
                
                text2: `Hello, this is the modified text.
This is the second line.
This line has been changed.
This is a new line added.
Another line of text.
Final line of the modified text.
One more new line.`
            };
            
            // 初始化行号
            updateLineNumbers(text1, lineNumbers1, lineCount1);
            updateLineNumbers(text2, lineNumbers2, lineCount2);
            
            // 默认开启实时比较
            realtimeToggle.checked = true;
            text1.addEventListener('input', handleTextChange);
            text2.addEventListener('input', handleTextChange);
            
            // 初始化比较
            compareTexts();
            
            // 加载示例数据
            exampleBtn.addEventListener('click', function() {
                text1.value = exampleData.text1;
                text2.value = exampleData.text2;
                updateLineNumbers(text1, lineNumbers1, lineCount1);
                updateLineNumbers(text2, lineNumbers2, lineCount2);
                hideMessages();
                compareTexts();
            });
            
            // 清空数据
            clearBtn.addEventListener('click', function() {
                text1.value = '';
                text2.value = '';
                updateLineNumbers(text1, lineNumbers1, lineCount1);
                updateLineNumbers(text2, lineNumbers2, lineCount2);
                highlight1.innerHTML = '';
                highlight2.innerHTML = '';
                hideMessages();
                showSuccess('文本已清空');
            });
            
            // 比较文本
            compareBtn.addEventListener('click', function() {
                compareTexts();
            });
            
            // 实时比较切换
            // realtimeToggle.addEventListener('change', function() {
            //     if (this.checked) {
            //         // 启用实时比较
            //         text1.addEventListener('input', handleTextChange);
            //         text2.addEventListener('input', handleTextChange);
            //         compareTexts();
            //     } else {
            //         // 禁用实时比较
            //         text1.removeEventListener('input', handleTextChange);
            //         text2.removeEventListener('input', handleTextChange);
            //     }
            // });
            
            // 文本变化处理
            function handleTextChange() {
                updateLineNumbers(text1, lineNumbers1, lineCount1);
                updateLineNumbers(text2, lineNumbers2, lineCount2);
                compareTexts();
            }
            
            // 更新行号显示
            function updateLineNumbers(textarea, lineNumbersElement, lineCountElement) {
                const lines = textarea.value.split('\n').length;
                lineCountElement.textContent = `行数: ${lines}`;
                
                let numbersHTML = '';
                for (let i = 1; i <= lines; i++) {
                    numbersHTML += `<div>${i}</div>`;
                }
                lineNumbersElement.innerHTML = numbersHTML;
                
                // 同步滚动
                lineNumbersElement.scrollTop = textarea.scrollTop;
            }
            
            // 同步滚动
            text1.addEventListener('scroll', function() {
                lineNumbers1.scrollTop = this.scrollTop;
                highlight1.scrollTop = this.scrollTop;
            });
            
            text2.addEventListener('scroll', function() {
                lineNumbers2.scrollTop = this.scrollTop;
                highlight2.scrollTop = this.scrollTop;
            });
            
            // 文本框自适应高度
            function autoResizeTextarea(textarea) {
                // 重置高度为auto以正确计算scrollHeight
                textarea.style.height = 'auto';
                // 设置高度为scrollHeight
                textarea.style.height = textarea.scrollHeight + 'px';
                
                // 同步高亮区域高度
                const highlight = textarea.nextElementSibling;
                if (highlight && highlight.classList.contains('highlight-overlay')) {
                    highlight.style.height = textarea.scrollHeight + 'px';
                }
                
                // 同步容器高度
                const wrapper = textarea.closest('.text-area-wrapper');
                if (wrapper) {
                    wrapper.style.height = 'auto';
                    wrapper.style.height = textarea.scrollHeight + 'px';
                }
            }
            
            // 初始化自适应高度
            autoResizeTextarea(text1);
            autoResizeTextarea(text2);
            
            // 监听输入变化，调整高度
            text1.addEventListener('input', function() {
                autoResizeTextarea(this);
            });
            
            text2.addEventListener('input', function() {
                autoResizeTextarea(this);
            });
            
            // 隐藏所有消息
            function hideMessages() {
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
            }
            
            // 显示错误消息
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
            
            // 显示成功消息
            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            }
            
            // 比较文本
            function compareTexts() {
                hideMessages();
                
                const text1Value = text1.value;
                const text2Value = text2.value;
                
                if (!text1Value && !text2Value) {
                    showError('请输入要比较的文本');
                    return;
                }
                
                try {
                    // 将文本分割为行数组
                    const lines1 = text1Value.split('\n');
                    const lines2 = text2Value.split('\n');
                    
                    // 执行比较
                    const result = compareLines(lines1, lines2);
                    
                    // 在原文本上高亮显示差异
                    highlightDifferences(text1, highlight1, lines1, result.removed, result.modified);
                    highlightDifferences(text2, highlight2, lines2, result.added, result.modified);
                    
                    showSuccess('文本比较完成');
                } catch (error) {
                    showError(`比较过程中出错: ${error.message}`);
                }
            }
            
            // 比较行数据
            function compareLines(lines1, lines2) {
                const result = {
                    added: [],
                    removed: [],
                    modified: [],
                    unchanged: []
                };
                
                const maxLength = Math.max(lines1.length, lines2.length);
                
                for (let i = 0; i < maxLength; i++) {
                    const line1 = lines1[i] || '';
                    const line2 = lines2[i] || '';
                    
                    if (i >= lines1.length) {
                        // 文本1没有此行，文本2有此行 -> 新增
                        result.added.push(i);
                    } else if (i >= lines2.length) {
                        // 文本2没有此行，文本1有此行 -> 删除
                        result.removed.push(i);
                    } else if (line1 === line2) {
                        // 两行相同 -> 未变化
                        result.unchanged.push(i);
                    } else {
                        // 两行不同 -> 修改
                        result.modified.push(i);
                    }
                }
                
                return result;
            }
            
            // 高亮显示差异 - 修复版本
            function highlightDifferences(textarea, highlightElement, lines, differentLines1, differentLines2) {
                // 保存当前光标位置
                const cursorPosition = textarea.selectionStart;
                
                // 生成高亮文本
                let highlightedHTML = '';
                for (let i = 0; i < lines.length; i++) {
                    const line = escapeHtml(lines[i]);
                    if (differentLines1.includes(i) || differentLines2.includes(i)) {
                        highlightedHTML += `<div class="line different">${line}</div>`;
                    } else {
                        highlightedHTML += `<div class="line">${line}</div>`;
                    }
                }
                
                // 更新高亮内容
                highlightElement.innerHTML = highlightedHTML;
                
                // 同步滚动
                highlightElement.scrollTop = textarea.scrollTop;
                
                // 恢复光标位置
                textarea.setSelectionRange(cursorPosition, cursorPosition);
            }
            
            // HTML转义函数
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        });
    </script>
</body>
</html>